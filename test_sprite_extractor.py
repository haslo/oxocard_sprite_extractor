import sys
import io
import re
from unittest import TestCase, main
from unittest.mock import patch
import sprite_extractor

class TestSpriteExtractor(TestCase):
    def setUp(self):
        self.expected_output_pattern = r"""# image
sprite_\d{14}:byte\[24\*24\] = \[
0,0,0,0,0,0,0,0,0,0,1,1,1,120,120,1,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,168,120,120,120,120,120,168,168,1,1,0,0,0,0,
0,0,0,0,0,0,0,0,1,120,120,120,120,120,120,120,120,120,168,168,1,0,0,0,
0,0,0,0,0,0,0,0,168,120,120,120,120,120,120,168,168,168,34,168,168,0,0,0,
0,0,0,0,0,0,0,0,120,1,120,120,168,168,168,168,168,168,98,34,168,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,168,168,168,98,98,15,168,168,34,1,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,168,168,98,98,98,15,1,98,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,168,168,168,98,98,34,34,34,34,98,1,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,168,168,98,98,98,34,98,1,0,0,0,0,0,
0,0,0,0,0,0,1,1,168,168,168,1,168,168,98,98,1,1,168,0,0,0,0,0,
0,0,0,0,0,1,120,120,1,1,168,168,1,1,120,120,120,168,1,0,0,0,0,0,
0,0,0,0,1,168,168,120,120,120,1,168,168,168,168,168,168,1,1,15,15,15,1,0,
0,0,0,1,168,120,120,168,120,120,1,120,168,168,120,168,168,1,15,15,120,120,15,1,
0,0,0,15,15,15,168,168,168,1,1,120,120,120,120,120,120,1,15,15,15,120,15,1,
0,0,0,15,120,15,15,168,1,0,1,120,120,168,168,168,120,1,168,15,15,15,15,1,
0,0,0,15,120,15,15,15,1,0,0,1,120,120,120,120,1,168,168,168,168,15,1,0,
0,0,0,1,15,15,15,1,0,0,1,168,168,168,168,168,1,1,168,168,1,0,0,0,
0,0,0,0,0,0,0,0,0,1,120,120,120,120,168,168,120,120,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,168,120,120,120,120,1,120,120,120,1,0,0,0,0,0,
0,0,0,0,0,0,0,1,168,168,168,168,168,1,120,120,120,168,168,0,0,0,0,0,
0,0,0,0,0,0,1,168,120,120,168,168,1,0,168,168,168,168,168,1,0,0,0,0,
0,0,0,0,0,1,168,168,120,120,168,168,0,1,168,120,120,168,1,1,0,0,0,0,
0,0,0,0,1,168,168,168,168,1,1,1,0,168,168,168,168,168,168,168,1,0,0,0,
0,0,0,1,168,168,168,168,168,168,168,168,1,168,168,168,168,168,168,168,168,0,0,0
\]"""

    @patch('sys.argv', ['sprite_extractor.py', 'test.png'])
    @patch('sys.stdout', new_callable=io.StringIO)
    def test_process_image(self, mock_stdout):
        sprite_extractor.process_image('test.png')
        output = mock_stdout.getvalue()
        
        self.assertRegex(output, self.expected_output_pattern)

if __name__ == '__main__':
    main()
